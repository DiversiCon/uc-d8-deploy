langcode: en
status: true
id: migrate_content_story
class: Drupal\migrate\Plugin\Migration
field_plugin_method: null
cck_plugin_method: null
migration_tags:
  - 'Drupal 7'
  - Content
migration_group: legacy
label: 'Content: Story'
source:
  plugin: d7_node_story
  node_type: news
  track_changes: true
  constants:
    format: simple_html
    news: 36
process:
  langcode:
    plugin: default_value
    source: language
    default_value: und
  title: title
  field_headline_text: title
  uid:
    plugin: migration_lookup
    migration: migrate_users
    source: node_uid
  status: status
  moderation_state:
    plugin: static_map
    source: status
    bypass: true
    map:
      1: published
      'TRUE': published
      '1': published
  created: created
  changed: changed
  promote: promote
  sticky: sticky
  revision_uid:
    plugin: migration_lookup
    migration: migrate_users
    source: revision_uid
  revision_log: log
  revision_timestamp: timestamp
  field_date_no_time:
    plugin: format_date
    source: created
    from_format: 'U'
    to_format: 'Y-m-d'
    settings:
      validate_format: false
  smartbody_ids:
    plugin: migration_lookup
    migration: migrate_content_story_smartbody
    source: nid
  field_par_smartbody/target_id:
    plugin: extract
    source: '@smartbody_ids'
    index:
    - 0
  field_par_smartbody/target_revision_id:
    plugin: extract
    source: '@smartbody_ids'
    index:
    - 1
  body/value: preview_text
  body/format: constants/format
  field_image_main/target_id:
    plugin: migration_lookup
    migration: migrate_media_image
    source: field_rightimage/0/fid
  field_tag_reference:
    plugin: sub_process
    source: field_tags
    process:
      target_id: tid
  field_section:
    plugin: static_map
    source: field_newstype/0/tid
    bypass: true
    map:
      41: 61
      1: 61
      2: 61
# mapping for above if we keep news categories.
#      41: 106 (achievements)
#      1: 96 (announcements)
#      2: 101 (press releases)

destination:
  plugin: 'entity:node'
  default_bundle: story
migration_dependencies:
  required:
    - migrate_users
  optional:
    - d7_field_instance
dependencies:
  module:
    - uc_migrate
  enforced:
    module:
      - uc_migrate
