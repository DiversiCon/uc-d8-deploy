(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"4jgu":function(t,e,n){"use strict";function a(t,e,n,a,r,i,s){try{var o=t[i](s),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(a,r)}function r(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){function s(t){a(c,r,i,s,o,"next",t)}function o(t){a(c,r,i,s,o,"throw",t)}var c=t.apply(e,n);s(void 0)})}}function i(t,e){for(var n,a=0;a<e.length;a++)(n=e[a]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}var s=n("o0o1"),o=n.n(s),c=n("vDqi"),u=n.n(c),l=n("wd/R"),d=n.n(l),p=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{endpoint:"http://bsd-data.dev.uchicago.edu/api/event_index",instance:"pritzker"};(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.endpoint=e.endpoint,this.instance=e.instance}return function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(t,[{key:"getAllEvents",value:function(){var t=r(o.a.mark(function t(){var e,n,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e={},n=this.endpoint,n+="?_bsdInstanceId="+this.instance,t.prev=3,t.next=6,u.a.get(n);case 6:a=t.sent,e=a.data.data,t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),console.log(t.t0);case 13:return t.abrupt("return",e);case 14:case"end":return t.stop()}},t,this,[[3,10]])}));return function(){return t.apply(this,arguments)}}()},{key:"getFeaturedEvents",value:function(){var t=r(o.a.mark(function t(){var e,n,a,r,i,s=arguments;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0<s.length&&void 0!==s[0]?s[0]:0,n=this.endpoint,n+="?_bsdInstanceId="+this.instance,n+="&filter[date-group][group][conjunction]=AND",n+="&filter[event-start-filter][condition][path]=field_event_dates.value",n+="&filter[event-start-filter][condition][operator]=>",n+="&filter[event-start-filter][condition][value]="+d()().format("YYYY-MM-DD"),n+="&filter[event-start-filter][condition][memberOf]=date-group",n+="&filter[event-featured-filter][condition][path]=field_featured",n+="&filter[event-featured-filter][condition][value]=1",n+="&filter[event-featured-filter][condition][memberOf]=date-group",0<e&&(n+="&page[limit]="+e),n+="&include=field_event_image",n+="&sort[event-sort][path]=field_event_dates.value",n+="&sort[event-sort][direction]=ASC",a={images:[],results:[]},t.prev=16,t.next=19,u.a.get(n,{headers:{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"}});case 19:r=t.sent,i=void 0===r.data.included?[]:this._formatImages(r.data.included),a={images:i,results:this._normalize(r.data.data)},t.next=27;break;case 24:t.prev=24,t.t0=t.catch(16),console.log(t.t0);case 27:return t.abrupt("return",a);case 28:case"end":return t.stop()}},t,this,[[16,24]])}));return function(){return t.apply(this,arguments)}}()},{key:"getEventsById",value:function(){var t=r(o.a.mark(function t(e){var n,a,r,i,s,c;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n=this.endpoint,n+="?_bsdInstanceId="+this.instance,n+="&filter[id-group][group][conjunction]=OR",a=0;a<e.length;a++)r=e[a],n+="&filter[event-id-filter-".concat(a,"][condition][path]=id"),n+="&filter[event-id-filter-".concat(a,"][condition][value]=").concat(r),n+="&filter[event-id-filter-".concat(a,"][condition][memberOf]=id-group");return n+="&include=field_event_image",n+="&sort[event-sort][path]=field_event_dates.value",n+="&sort[event-sort][direction]=ASC",i={images:[],results:[]},t.prev=8,t.next=11,u.a.get(n,{headers:{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"}});case 11:s=t.sent,c=void 0===s.data.included?[]:this._formatImages(s.data.included),i={images:c,results:this._normalize(s.data.data)},t.next=19;break;case 16:t.prev=16,t.t0=t.catch(8),console.log(t.t0);case 19:return t.abrupt("return",i);case 20:case"end":return t.stop()}},t,this,[[8,16]])}));return function(){return t.apply(this,arguments)}}()},{key:"getEventsByRange",value:function(){var t=r(o.a.mark(function t(e,n){var a,r,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.endpoint,a+="?_bsdInstanceId="+this.instance,a+="&filter[date-group][group][conjunction]=AND",a+="&filter[event-start-filter][condition][path]=field_event_dates.value",a+="&filter[event-start-filter][condition][operator]=>",a+="&filter[event-start-filter][condition][value]="+e,a+="&filter[event-start-filter][condition][memberOf]=date-group",a+="&filter[event-end-filter][condition][path]=field_event_dates.end_value",a+="&filter[event-end-filter][condition][operator]=<",a+="&filter[event-end-filter][condition][value]="+n,a+="&filter[event-end-filter][condition][memberOf]=date-group",a+="&sort[event-sort][path]=field_event_dates.value",a+="&sort[event-sort][direction]=ASC",r={},t.prev=14,t.next=17,u.a.get(a,{headers:{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"}});case 17:i=t.sent,r=this._normalize(i.data.data),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(14),console.log(t.t0);case 24:return t.abrupt("return",r);case 25:case"end":return t.stop()}},t,this,[[14,21]])}));return function(){return t.apply(this,arguments)}}()},{key:"getEventsFromQuery",value:function(){var t=r(o.a.mark(function t(e){var n,a,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.endpoint,n+="?_bsdInstanceId="+this.instance,n+="&filter[search-group][group][conjunction]=OR",n+="&filter[title-search][condition][path]=title",n+="&filter[title-search][condition][operator]=CONTAINS",n+="&filter[title-search][condition][value]="+e,n+="&filter[title-search][condition][memberOf]=search-group",n+="&filter[desc-search][condition][path]=field_description",n+="&filter[desc-search][condition][operator]=CONTAINS",n+="&filter[desc-search][condition][value]="+e,n+="&filter[desc-search][condition][memberOf]=search-group",n+="&filter[event-start-filter][condition][path]=field_event_dates.value",n+="&filter[event-start-filter][condition][operator]=>",n+="&filter[event-start-filter][condition][value]="+d()().format("YYYY-MM-DD"),n+="&sort[event-sort][path]=field_event_dates.value",n+="&sort[event-sort][direction]=ASC",a={},t.prev=17,t.next=20,u.a.get(n,{headers:{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"}});case 20:r=t.sent,a=this._normalize(r.data.data),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(17),console.log(t.t0);case 27:return t.abrupt("return",a);case 28:case"end":return t.stop()}},t,this,[[17,24]])}));return function(){return t.apply(this,arguments)}}()},{key:"getLastEvent",value:function(){var t=r(o.a.mark(function t(){var e,n,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.endpoint,e+="?_bsdInstanceId="+this.instance,e+="&sort[sort-date][path]=field_event_dates.value",e+="&sort[sort-date][direction]=DESC",e+="&page[limit]=1",e+="&fields[node--event]=field_event_dates",n="",t.prev=7,t.next=10,u.a.get(e,{headers:{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"}});case 10:a=t.sent,n=a.data.data[0].attributes.field_event_dates.value,t.next=17;break;case 14:t.prev=14,t.t0=t.catch(7),console.log(t.t0);case 17:return t.abrupt("return",n);case 18:case"end":return t.stop()}},t,this,[[7,14]])}));return function(){return t.apply(this,arguments)}}()},{key:"_normalize",value:function(t){var e=[];return t.forEach(function(t){var n={id:t.id},a=t.attributes;n.drupalId=a.drupal_internal__nid,n.allDay=a.field_all_day,n.contact=a.field_contact;var r=a.field_event_dates;n.start=r.value,n.end=r.end_value,n.caption=a.field_event_image_caption,n.status=a.field_event_status,n.featured=a.field_featured,n.location=a.field_location,n.title=a.title,n.pathAlias=a.path.alias,n.link=t.links.self.href,null!==t.relationships.field_event_image.data&&(n.imgId=t.relationships.field_event_image.data.id),e.push(n)}),e}},{key:"_formatImages",value:function(t){var e=[];return t&&t.forEach(function(t){e[t.id]=t.links.event_image.href}),e}}]),t}();e.a=p},"5WL1":function(t,e,n){"use strict";function a(t,e,n,a,r,i,s){try{var o=t[i](s),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(a,r)}function r(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){function s(t){a(c,r,i,s,o,"next",t)}function o(t){a(c,r,i,s,o,"throw",t)}var c=t.apply(e,n);s(void 0)})}}n.r(e);var i=n("o0o1"),s=n.n(i),o=n("bt/X"),c=n.n(o),u=n("k4Da"),l=n.n(u),d=(n("ijCd"),n("P/G1")),p=n.n(d),v=n("uM7l"),f=n.n(v),h=n("wd/R"),_=n.n(h),g=n("4jgu"),m=(n("3wa0"),{name:"UcEvents",components:{ucPager:function(){return n.e(23).then(n.bind(null,"cVDb"))}},props:{endpoint:{type:String,required:!0,default:"http://bsd-data.dev.uchicago.edu/api/event_index"},instance:{type:String,required:!0,default:"pritzker"},featured:{type:Boolean,default:!1}},data:function(){return{allEvents:null,groupedEvents:null,filterkey:"displayDate",results:[],searchResults:[],noResults:null,query:null,isSearch:null!==this.query&&""!==this.query,pagination:{currentIndex:0,currentPage:1,totalPages:1,totalPerPage:5,searchPerPage:5,totalResults:0,currentResults:0,startDate:null,endDate:null,lastDate:null},isLoading:!0,eventsAPI:new g.a({endpoint:this.endpoint,instance:this.instance}),searchIndex:null}},mounted:function(){var t=this;t.resetDateRange(),void 0!==t.$route.query.query&&""!==t.$route.query.query?(t.query=t.$route.query.query,t.isSearch=!0):t.isSearch=!1,this.loadEvents()},methods:{doSearch:function(){var t=r(s.a.mark(function t(){var e,n,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(e=this).resetPager(),e.isLoading=!0,""===e.query?(e.isSearch=!1,e.pagination.currentIndex=0,e.removeQuery(),e.loadEvents()):(e.isSearch=!0,e.updateQuery("query",e.query),n=[],""===e.query?n=e.allData:(a=e.query.toLowerCase().split(" "),n=l()(e.allEvents,function(t){var e=!1,n=[];return(n=n.concat(t.title.toLowerCase().split(" "))).some(function(t){if(a.some(function(n){if(t===n)return e=!0,!0}),e)return!0}),e})),0===n.length?(e.noResults=!0,e.results=[],e.searchResults=[],e.pagination.totalPages=0):(e.noResults=!1,e.pagination.totalResults=Object.keys(n).length,e.pagination.currentResults=e.pagination.totalResults>e.pagination.totalPerPage?e.pagination.totalPerPage:e.pagination.totalResults,e.processResults(n)));case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getPaginationInfo:function(){var t=r(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:null!=(e=this).groupedEvents&&(e.pagination.totalPages=Math.ceil(e.groupedEvents.length/e.pagination.totalPerPage));case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),loadEvents:function(){var t=r(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(e=this).isLoading=!0,t.next=4,e.eventsAPI.getAllEvents();case 4:e.allEvents=t.sent,e.noResults=0===e.allEvents.length,e.isSearch?e.doSearch():!e.noResults&&e.processResults();case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),processResults:function(){var t=r(s.a.mark(function t(){var e,n,a,r,i=arguments;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0<i.length&&void 0!==i[0]?i[0]:this.allEvents,(n=this).getPaginationInfo(),a=[],e.forEach(function(t){if(t.start!==t.end)for(var e,r=_.a.utc(t.start).format("YYYY-MM-DD"),i=_.a.utc(t.end).format("YYYY-MM-DD"),s=_()(r).twix(i).toArray("days"),o=0;o<s.length;o++)(e=f()(t)).displayDate=n.formatDate(s[o]),a.push(e);else t.displayDate=n.formatDate(t.start),a.push(t)}),t.next=7,c()(a,n.filterkey);case 7:r=t.sent,n.groupedEvents=p()(r),n.getPagedResults(1),n.isLoading=!1;case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getPagedResults:function(t){var e=this;e.getPaginationInfo();var n=1===t?0:(t-1)*e.pagination.totalPerPage,a=n+e.pagination.totalPerPage;e.results=e.groupedEvents.slice(n,a)},formatDate:function(t){return _.a.utc(t).format("dddd, MMMM D, YYYY")},formatDateRange:function(t,e){var n=_.a.utc(t).format("ddd, MMM DD, YYYY"),a=_.a.utc(e).format("ddd, MMM DD, YYYY");return n!==a&&(n+=" - "+a),n},formatTime:function(t,e){var n=_.a.utc(t).format("h:mm a");return n+=t===e?"":" - "+_.a.utc(e).format("h:mm a")},handlePage:function(t){this.getPagedResults(t),this.scrollToTop()},resetPager:function(){1<this.pagination.totalPages&&(this.$refs.pager.currentPage=1,this.pagination.currentIndex=0)},scrollToTop:function(){var t=document.documentElement.scrollTop||document.body.scrollTop,e=this.$el.offsetTop-40;t>e&&(window.requestAnimationFrame(this.scrollToTop),window.scrollTo(e,t-t/15)),this.focusTop()},focusTop:function(){var t=this;setTimeout(function(){var e=t.$el.querySelector(".c-events__item a");e&&e.focus()},150)},updateQuery:function(t,e){var n=Object.assign({},this.$route.query);n[t]=e,this.$router.replace({query:n})},removeQuery:function(){var t=Object.assign({},this.$route.query);delete t.query,this.$router.replace({query:t})},resetDateRange:function(){this.pagination.startDate=_()().format("YYYY-MM-DD"),this.pagination.endDate=_()().add(1,"weeks").format("YYYY-MM-DD")}}}),y=n("KHd+"),b=Object(y.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"c-events",class:{"c-events--featured":t.featured}},[n("div",{staticClass:"c-searchform"},[n("form",{attrs:{autocomplete:"off","accept-charset":"UTF-8"},on:{submit:function(e){return e.preventDefault(),t.doSearch(e)}}},[n("div",{staticClass:"c-searchform__input_container"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.query,expression:"query"}],attrs:{type:"text",name:"query","aria-label":"Search for an event",placeholder:"Search for an event"},domProps:{value:t.query},on:{input:function(e){e.target.composing||(t.query=e.target.value)}}}),t._v(" "),n("button",{attrs:{type:"submit",role:"button","aria-label":"search"},on:{click:function(e){return e.preventDefault(),t.doSearch(e)}}},[n("uc-icon",{attrs:{glyph:"search"}})],1)])])]),t._v(" "),n("article",{staticClass:"c-article"},[n("div",{staticClass:"c-article__body"},[t.isSearch?n("div",{staticClass:"c-events__ctn c-events__search-results"},[0===t.results.length?n("h2",{staticClass:"c-events__no-results"},[t._v('No results to display for "'+t._s(t.$route.query.query)+'"\n        ')]):t.isLoading?t._e():n("p",{staticClass:"c-events__search-summary"},[t._v("\n          Displaying results "+t._s(t.pagination.currentIndex+1)+"\n          - "+t._s(t.pagination.currentResults)+"\n          out of "+t._s(t.pagination.totalResults)+" for "),n("strong",[t._v(t._s(t.$route.query.query))])]),t._v(" "),t._l(t.results,function(e){return n("div",{key:"day-"+e[0].id,staticClass:"c-events__ctn"},[n("h2",[t._v(t._s(e[0].displayDate))]),t._v(" "),n("ul",t._l(e,function(e){return n("li",{key:"item-"+e.id,staticClass:"c-events__item"},[e.status?n("p",{staticClass:"c-events__status"},[t._v(t._s(e.status))]):t._e(),t._v(" "),e.allDay?t._e():n("p",[t._v(t._s(t.formatTime(e.start,e.end)))]),t._v(" "),n("p",[n("a",{attrs:{href:e.pathAlias?"/event"+e.pathAlias:"/event/"+e.id}},[t._v("\n                  "+t._s(e.title)+"\n                ")])]),t._v(" "),e.location?n("p",[t._v(t._s(e.location))]):t._e(),t._v(" "),e.address?n("p",[t._v(t._s(e.address))]):t._e()])}),0)])})],2):n("div",t._l(t.results,function(e){return n("div",{key:"day-"+e[0].id,staticClass:"c-events__ctn"},[n("h2",[t._v(t._s(e[0].displayDate))]),t._v(" "),n("ul",t._l(e,function(e){return n("li",{key:"item-"+e.id,staticClass:"c-events__item"},[e.status?n("p",{staticClass:"c-events__status"},[t._v(t._s(e.status))]):t._e(),t._v(" "),e.allDay?t._e():n("p",[t._v(t._s(t.formatTime(e.start,e.end)))]),t._v(" "),n("p",[n("a",{attrs:{href:e.pathAlias?"/event"+e.pathAlias:"/event/"+e.id}},[t._v("\n                  "+t._s(e.title)+"\n                ")])]),t._v(" "),e.location?n("p",[t._v(t._s(e.location))]):t._e(),t._v(" "),e.address?n("p",[t._v(t._s(e.address))]):t._e()])}),0)])}),0)])]),t._v(" "),n("uc-pager",{directives:[{name:"show",rawName:"v-show",value:1<t.pagination.totalPages,expression:"pagination.totalPages > 1"}],ref:"pager",staticClass:"c-list__pager",attrs:{"on-page":t.handlePage,page:t.pagination.currentPage,total:t.pagination.totalPages}})],1)},[],!1,null,null,null);e.default=b.exports}}]);