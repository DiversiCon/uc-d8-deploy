(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{"840n":function(e,t,a){"use strict";function n(e,t,a,n,r,s,o){try{var i=e[s](o),l=i.value}catch(e){return void a(e)}i.done?t(l):Promise.resolve(l).then(n,r)}function r(e){return function(){var t=this,a=arguments;return new Promise(function(r,s){function o(e){n(l,r,s,o,i,"next",e)}function i(e){n(l,r,s,o,i,"throw",e)}var l=e.apply(t,a);o(void 0)})}}a.r(t);var s=a("o0o1"),o=a.n(s),i=a("vDqi"),l=a.n(i),u=a("wd/R"),c=a.n(u),d=a("/+cc"),p=a.n(d),h=a("k4Da"),f=a.n(h),_=a("qPyV"),v=a.n(_),y=a("k8Y/"),g=a.n(y),b={name:"uc-pub-list",components:{ucPager:function(){return a.e(23).then(a.bind(null,"cVDb"))},ucDropdown:function(){return a.e(9).then(a.bind(null,"P8gK"))}},props:{endpoint:{type:String,default:"http://bsd-data.dev.uchicago.edu/api/node/publication"},authorType:{type:String,default:"faculty"},staffId:{type:String,required:!1},staffUrl:{type:String,required:!1},headline:{type:String,default:"Publications"},hideTopics:{type:Boolean,default:!1}},data:function(){return{allPubs:null,pubMedUrl:"https://www.ncbi.nlm.nih.gov/pubmed",results:null,pagedResults:null,noResults:null,author:null,query:"",isLoading:!0,isSearchResults:!1,searchIndex:null,pagination:{currentIndex:0,currentPage:1,totalPages:1,totalPerPage:10,totalResults:0,currentResults:0},isDropdownSort:!1,yearDropdownOptions:[],yearDropdownSelected:"All",topicDropdownOptions:[],topicDropdownSelected:"All"}},mounted:function(){var e=r(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).isLoading=!0,null!==t.$route.query.query&&t.$route.query.query&&(t.query=t.$route.query.query),null!==t.$route.query.years&&t.$route.query.years&&(t.yearDropdownSelected=t.$route.query.years),e.next=6,t.getAllPubs();case 6:t.loadYearDropdown(),t.loadTopicDropdown(),t.isLoading=!1;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{getAllPubs:function(){var e=r(o.a.mark(function e(){var t,a,n,r,s,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).allPubs=[],a="",e.prev=3,n={include:"field_topics",sort:"-field_year,-field_publication_date"},t.staffId&&(n["filter[field_associated_people.id]"]=t.staffId),e.next=8,l.a.get(t.endpoint,{params:n});case 8:r=e.sent,t.allPubs=t.normalize(r.data),t.staffId&&(t.author=t.getAuthor(t.staffId)),t.queryHasValue()||(t.setResults(t.allPubs),t.getResults(1)),"next"in r.data.links&&(a=r.data.links.next.href),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),console.log(e.t0);case 18:if(""===a){e.next=32;break}return e.prev=19,e.next=22,l.a.get(a);case 22:s=e.sent,t.allPubs=t.allPubs.concat(t.normalize(s.data)),a="next"in s.data.links?s.data.links.next.href:"",e.next=30;break;case 27:e.prev=27,e.t1=e.catch(19),console.log(e.t1);case 30:e.next=18;break;case 32:t.setResults(t.allPubs),t.getPaginationInfo(),i={shouldSort:!0,tokenize:!0,threshold:0,location:0,distance:0,maxPatternLength:32,minMatchCharLength:1,keys:["label","authors","pmid"]},t.searchIndex=new p.a(t.allPubs,i),t.queryHasValue()&&t.searchPublications();case 37:case"end":return e.stop()}},e,this,[[3,15],[19,27]])}));return function(){return e.apply(this,arguments)}}(),getAuthor:function(e){var t=this,a="fields[node--faculty]=field_first_name,field_last_name";switch(t.authorType){case"person":a="fields[node--person]=field_headline_text"}l.a.get("".concat(t.endpoint,"/").concat(e,"?").concat(a)).then(function(e){var a=e.data.data.attributes;switch(t.authorType){case"person":t.author="".concat(a.field_headline_text.value);break;case"group":break;case"faculty":t.author="".concat(a.field_first_name," ").concat(a.field_last_name)}}).catch(function(e){console.log(e)})},normalize:function(e){var t=[],a=e.included;return e.data.forEach(function(e){var n={id:e.id},r=e.attributes;n.drupalId=r.drupal_internal__nid,n.authors=r.field_author_list,n.citation=r.field_citation,n.label=r.title,n.pmid=r.field_pmid,n.publication=r.field_publication,n.publicationDate=r.field_publication_date,n.year=r.field_year,n.linkUrl=r.field_link_single;var s="";null!=e.attributes.field_publication_date&&""!==e.attributes.field_publication_date&&(s=c()(e.attributes.field_publication_date).unix()),n.timestamp=s,null==n.year&&(n.year=0);var o=[];null!=e.relationships.field_topics&&e.relationships.field_topics.data.forEach(function(e){o.push(e.id)}),n.topics=[],n.linkUrl=null==n.linkUrl?"":null==n.linkUrl.uri?"":n.linkUrl.uri,o.forEach(function(e){a.forEach(function(t){e===t.id&&n.topics.push(t.attributes.name)})}),t.push(n)}),t},setResults:function(e){this.results=g()(e,["year","timestamp"],["desc","desc"])},getResults:function(e){var t=this,a=1===e?0:(e-1)*t.pagination.totalPerPage,n=a+t.pagination.totalPerPage;t.pagedResults=t.results.slice(a,n)},searchPublications:function(){var e=this;e.resetYearDropdown(),e.resetTopicDropdown(),e.updateQueryString(),e.isSearchResults=!1;var t=e.allPubs;e.queryHasValue()&&(e.isSearchResults=!0,t=e.searchIndex.search(e.query)),e.isSearchResults?0===t.length?(e.noResults=!0,e.results=[]):(e.noResults=!1,e.setResults(t)):(e.noResults=!1,e.setResults(e.allPubs)),e.getResults(1),e.getPaginationInfo()},queryHasValue:function(){return""!==this.query},updateQueryString:function(){""===this.query?this.removeSearchQuery():this.$router.replace({query:{query:this.query}})},removeSearchQuery:function(){var e=Object.assign({},this.$route.query);delete e.query,this.$router.replace({query:e})},removeAuthors:function(e,t){return null===e&&(e=""),e.replace("".concat(t,". "),"")},getPaginationInfo:function(){var e=this;e.pagination.totalPages=Math.ceil(e.results.length/e.pagination.totalPerPage)},handlePage:function(e){this.scrollToTop(),this.getResults(e)},loadYearDropdown:function(){var e=this,t=[{name:"All Years",value:"All"}];e.allPubs.forEach(function(e){null!=e.year&&0!==e.year&&t.push({name:e.year,value:e.year})}),t=v()(t,"name"),t=g()(t,"name","desc"),e.yearDropdownOptions=t,"All"!==e.yearDropdownSelected&&e.$refs.dropdownYear.handleSelect({name:e.yearDropdownSelected,value:e.yearDropdownSelected},!1)},handleYearDropdownChange:function(e){var t=this;t.resetSearch(),t.resetTopicDropdown(),t.isSearchResults=!1,t.isDropdownSort=!0;var a=t.allPubs;"All"!==e&&(a=f()(t.allPubs,function(t){return t.year===e})),t.setResults(a),t.getResults(1),t.getPaginationInfo()},resetSearch:function(){var e=this;e.query="",e.isSearchResults=!1,e.removeSearchQuery()},resetYearDropdown:function(){var e=this;void 0!==e.$refs.dropdownYear&&(e.$refs.dropdownYear.reset(),e.removeYearQuery())},removeYearQuery:function(){var e=Object.assign({},this.$route.query);delete e.years,this.$router.replace({query:e})},loadTopicDropdown:function(){var e=this,t=[{name:"All Topics",value:"All"}];e.allPubs.forEach(function(e){e.topics.forEach(function(e){t.push({name:e,value:e})})}),t=v()(t,"name"),t=g()(t,"name","asc"),e.topicDropdownOptions=t,"All"!==e.topicDropdownSelected&&e.$refs.dropdownTopic.handleSelect({name:e.topicDropdownSelected,value:e.topicDropdownSelected},!1)},handleTopicDropdownChange:function(e){var t=this;t.resetSearch(),t.resetYearDropdown(),t.isSearchResults=!1,t.isDropdownSort=!0;var a=t.allPubs;"All"!==e&&(a=f()(t.allPubs,function(t){var a=!1;return t.topics.some(function(t){if(t===e)return a=!0,!0}),a})),t.setResults(a),t.getResults(1),t.getPaginationInfo()},resetTopicDropdown:function(){var e=this;void 0!==e.$refs.dropdownTopic&&(e.$refs.dropdownTopic.reset(),e.removeTopicQuery())},removeTopicQuery:function(){var e=Object.assign({},this.$route.query);delete e.topics,this.$router.replace({query:e})},scrollToTop:function(){var e=document.documentElement.scrollTop||document.body.scrollTop,t=this.$el.offsetTop-40;e>t&&(window.requestAnimationFrame(this.scrollToTop),window.scrollTo(t,e-e/15)),this.focusTop()},focusTop:function(){var e=this;setTimeout(function(){var t=e.$el.querySelector(".c-pub-list a");t&&t.focus()},150)}}},m=a("KHd+"),w=Object(m.a)(b,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.staffUrl?a("section",{staticClass:"l-container c-content"},[a("div",{staticClass:"c-content__body"},[a("header",{staticClass:"c-headline c-headline--lg"},[a("a",{staticClass:"c-headline__topic t-heading--topic",attrs:{href:""+e.staffUrl}},[e._v(e._s(e.author))]),e._v(" "),a("h1",{staticClass:"c-headline__heading"},[e._v(e._s(e.headline))])])])]):e._e(),e._v(" "),a("div",{staticClass:"c-pub-list"},[a("div",{ref:"controls",staticClass:"c-pub-list__controls",class:{"c-pub-list__controls--hide-topics":e.hideTopics}},[a("div",{staticClass:"c-searchform c-pub-list__searchform"},[a("form",{attrs:{autocomplete:"off","accept-charset":"UTF-8"},on:{submit:function(t){return t.preventDefault(),e.searchPublications(t)}}},[a("div",{staticClass:"c-searchform__input_container"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.query,expression:"query"}],attrs:{type:"text",name:"query",placeholder:"Search Publications"},domProps:{value:e.query},on:{input:function(t){t.target.composing||(e.query=t.target.value)}}}),e._v(" "),a("button",{attrs:{type:"submit"},on:{click:function(t){return t.preventDefault(),e.searchPublications(t)}}},[a("uc-icon",{attrs:{glyph:"search"}})],1)])])]),e._v(" "),e.hideTopics?e._e():a("uc-dropdown",{ref:"dropdownTopic",staticClass:"c-pub-list__dropdown",attrs:{options:e.topicDropdownOptions,"default-selection":e.topicDropdownSelected,"on-select":e.handleTopicDropdownChange,"display-name":"All Topics",name:"topics"}}),e._v(" "),a("uc-dropdown",{ref:"dropdownYear",staticClass:"c-pub-list__dropdown",attrs:{options:e.yearDropdownOptions,"default-selection":e.yearDropdownSelected,"on-select":e.handleYearDropdownChange,"display-name":"All Years",name:"years"}})],1),e._v(" "),a("section",{staticClass:"c-pub-list__search-info"},[e.noResults&&e.isSearchResults?a("div",{staticClass:"c-pub-list__noresults"},[a("h2",[e._v("No results found.")])]):!e.isLoading&&e.isSearchResults?a("p",{staticClass:"c-pub-list__search-summary"},[e._v("\n        Displaying "+e._s(e.results.length)+" results for "),a("strong",[e._v(e._s(e.$route.query.query))])]):e._e()]),e._v(" "),e.noResults?e._e():a("section",{staticClass:"c-pub-list__content"},e._l(e.pagedResults,function(t){return a("div",{key:"pub-"+t.drupalId,staticClass:"c-pub-list__item"},[a("h3",{staticClass:"c-pub-list__item-title"},[a("a",{attrs:{href:""+t.linkUrl,target:"_blank"}},[e._v("\n            "+e._s(t.label)+"\n          ")])]),e._v(" "),a("p",{staticClass:"c-pub-list__item-publication"},[e._v(e._s(t.citation))])])}),0)]),e._v(" "),a("uc-pager",{directives:[{name:"show",rawName:"v-show",value:1<e.pagination.totalPages,expression:"pagination.totalPages > 1"}],ref:"pager",staticClass:"c-list__pager",attrs:{"on-page":e.handlePage,page:e.pagination.currentPage,total:e.pagination.totalPages}})],1)},[],!1,null,null,null);t.default=w.exports},"k8Y/":function(e,t,a){var n=a("alwl"),r=a("Z0cm");e.exports=function(e,t,a,s){return null==e?[]:(r(t)||(t=null==t?[]:[t]),r(a=s?void 0:a)||(a=null==a?[]:[a]),n(e,t,a))}}}]);